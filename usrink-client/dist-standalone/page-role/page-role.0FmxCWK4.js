import{_ as xe,u as $e,s as ie,r as n,o as Se,i as R,b as c,d as Ue,e as C,f as y,g as l,p,h as M,j as a,k as d,l as s,m as q,q as Fe,n as A,F as ve}from"../3rdPlugin/3rdPlugin.CEm3-_ST.js";import{T as me}from"../TreeUtil/TreeUtil.BZ0Rd0P8.js";const Me=(_,B)=>{let u="";for(let e=0;e<_.length;e++)u+=_[e],(e+1)%B===0&&e!==_.length-1&&(u+="<br/>");return u},qe=_=>_==null?[]:_.split(","),Ae=_=>_==null?"":_.join(","),ee={addLineBreaks:Me,stringToArray:qe,arrayToString:Ae},Be={class:"page"},Ee={class:"top_btn_panel"},He={class:"role_desc"},je=["innerHTML"],Oe={class:"action_btn"},Ge={class:"add_role_form"},Je={class:"dialog-footer"},Qe={class:"edit_role_form"},We={class:"dialog-footer"},Xe={class:"dialog-footer"},Ye={class:"dialog-footer"},Ze={class:"dialog-footer"},el={class:"usr_role_perm_panel"},ll={style:{flex:"auto"}},al={__name:"page-role",setup(_){const B=$e(),u=ie(()=>B.currentLang),e=ie(()=>({roleName:u.value==="zh"?"角色名称":"Role Name",rolePermKey:u.value==="zh"?"角色标识符":"Role Permission Key",status:u.value==="zh"?"状态":"Status",normal:u.value==="zh"?"正常":"Normal",deleted:u.value==="zh"?"已删除":"Deleted",search:u.value==="zh"?"搜索":"Search",roleId:u.value==="zh"?"角色ID":"Role ID",roleDescription:u.value==="zh"?"角色描述":"Role Description",operations:u.value==="zh"?"操作":"Operations",noData:u.value==="zh"?"暂无数据":"No Data",addRole:u.value==="zh"?"添加角色":"Add Role",assignPermissions:u.value==="zh"?"分配权限":"Assign Permissions",edit:u.value==="zh"?"编辑":"Edit",delete:u.value==="zh"?"删除":"Delete",restore:u.value==="zh"?"恢复":"Restore",cancel:u.value==="zh"?"取消":"Cancel",confirm:u.value==="zh"?"确定":"Confirm",addRoleTitle:u.value==="zh"?"添加角色":"Add Role",editRoleTitle:u.value==="zh"?"编辑角色":"Edit Role",deleteConfirmTitle:u.value==="zh"?"删除确认":"Delete Confirmation",restoreConfirmTitle:u.value==="zh"?"恢复确认":"Restore Confirmation",permanentDeleteTitle:u.value==="zh"?"彻底删除":"Permanent Deletion",roleNameLabel:u.value==="zh"?"角色名称":"Role Name",permKeyLabel:u.value==="zh"?"权限标识符":"Permission Key",roleDescLabel:u.value==="zh"?"角色描述":"Role Description",roleNameRequired:u.value==="zh"?"角色名称不能为空！":"Role name cannot be empty!",rolePermKeyRequired:u.value==="zh"?"角色权限符不能为空！":"Role permission key cannot be empty!",assignPermissionsFor:r=>u.value==="zh"?`角色【${r}】权限分配`:`Permission assignment for role [${r}]`,deleteRoleConfirm:r=>u.value==="zh"?`确定删除角色【${r}】吗？`:`Are you sure you want to delete role [${r}]?`,restoreRoleConfirm:r=>u.value==="zh"?`确定恢复角色【${r}】吗？`:`Are you sure you want to restore role [${r}]?`,permanentDeleteConfirm:r=>u.value==="zh"?`确定彻底删除角色【${r}】吗？删除之后将无法恢复！`:`Are you sure you want to permanently delete role [${r}]? This cannot be undone!`})),g=n({roleName:"",rolePermKey:"",status:"0",pageNum:1,pageSize:10}),E=n(!1),le=n([]),ae=n(0);Se(()=>{h()});const h=()=>{E.value=!0,R.post("/sysRole/selectSysRoleList",{...g.value}).then(r=>{le.value=r.data.list||[],ae.value=r.data.total||0}).catch(r=>{console.error(r)}).finally(()=>{E.value=!1})},ce=r=>{g.value.pageNum=r,h()},pe=()=>{g.value.pageNum=1,h()},b=n({}),D=n(!1),H=n(!1),j=n(!1),T=n(null),oe=n({roleName:[{required:!0,message:()=>e.value.roleNameRequired,trigger:"blur"}],rolePermKey:[{required:!0,message:()=>e.value.rolePermKeyRequired,trigger:"blur"}]}),fe=()=>{b.value={},D.value=!0,T.value&&T.value.resetFields()},_e=()=>{T.value.validate(r=>{r&&(H.value=!0,j.value=!0,R.post("/sysRole/insertSysRole",{...b.value}).then(t=>{h()}).catch(t=>{console.error(t)}).finally(()=>{H.value=!1,j.value=!1,D.value=!1}))})},i=n({}),w=n(!1),O=n(!1),G=n(!1),x=n(null),ge=r=>{i.value={},i.value={...r},w.value=!0,x.value&&x.value.resetFields()},ye=()=>{x.value.validate(r=>{r&&(O.value=!0,G.value=!0,R.post("/sysRole/updateSysRole",{...i.value}).then(t=>{h()}).catch(t=>{console.error(t)}).finally(()=>{O.value=!1,G.value=!1,w.value=!1}))})},$=n({}),J=n([]),te=n(""),z=n(!1),N=n(!1),Q=n(!1),he=r=>{i.value={},i.value={roleId:r.roleId},te.value=e.value.assignPermissionsFor(r.roleName),z.value=!0,N.value=!0,R.get("/sysMenu/selectSysMenuCommonList").then(t=>{let f=t.data.list||[];J.value=me.buildMenuTree(f);let m=me.treeToFlat(J.value),V=ee.stringToArray(r.roleMenuIds),S=[];m.forEach(v=>{V.includes(v.menuId.toString())&&S.push(v.menuId)}),$.value.setCheckedKeys(S)}).catch(t=>{console.error(t)}).finally(()=>{N.value=!1})},be=()=>{N.value=!0,Q.value=!0;let r=$.value.getCheckedKeys(),t=$.value.getHalfCheckedKeys(),f=r.concat(t);f.sort((m,V)=>m-V),i.value.roleMenuIds=ee.arrayToString(f),R.post("/sysRole/updateRolePerm",{...i.value}).then(m=>{h()}).catch(m=>{console.error(m)}).finally(()=>{N.value=!1,Q.value=!1,z.value=!1})},re=n(""),I=n(!1),W=n(!1),Re=r=>{i.value={},i.value.roleId=r.roleId,re.value=e.value.deleteRoleConfirm(r.roleName),I.value=!0},Ve=()=>{W.value=!0,R.post("/sysRole/deleteSysRoleLogic",{...i.value}).then(r=>{h()}).catch(r=>{console.error(r)}).finally(()=>{W.value=!1,I.value=!1})},ue=n(""),K=n(!1),X=n(!1),ke=r=>{i.value={},i.value.roleId=r.roleId,ue.value=e.value.restoreRoleConfirm(r.roleName),K.value=!0},Ce=()=>{X.value=!0,R.post("/sysRole/recoverSysRole",{...i.value}).then(r=>{h()}).catch(r=>{console.error(r)}).finally(()=>{X.value=!1,K.value=!1})},ne=n(""),L=n(!1),Y=n(!1),De=r=>{i.value={},i.value.roleId=r.roleId,ne.value=e.value.permanentDeleteConfirm(r.roleName),L.value=!0},we=()=>{Y.value=!0,R.post("/sysRole/deleteSysRolePhysics",{...i.value}).then(r=>{h()}).catch(r=>{console.error(r)}).finally(()=>{Y.value=!1,L.value=!1})};return(r,t)=>{const f=c("el-input"),m=c("el-form-item"),V=c("el-option"),S=c("el-select"),v=c("el-button"),Z=c("el-form"),se=c("el-card"),k=c("el-table-column"),ze=c("el-tooltip"),de=c("el-tag"),Ne=c("el-empty"),Ie=c("el-table"),Ke=c("el-pagination"),P=c("el-dialog"),Le=c("el-tree"),Pe=c("el-scrollbar"),Te=c("el-drawer"),U=Ue("loading");return y(),C("div",Be,[l(se,{shadow:"never",class:"usr_card_override top"},{default:a(()=>[l(Z,{inline:!0,model:g.value},{default:a(()=>[l(m,{label:e.value.roleName},{default:a(()=>[l(f,{modelValue:g.value.roleName,"onUpdate:modelValue":t[0]||(t[0]=o=>g.value.roleName=o),maxlength:"10",placeholder:e.value.roleName,clearable:"",style:{width:"180px"}},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),l(m,{label:e.value.rolePermKey},{default:a(()=>[l(f,{modelValue:g.value.rolePermKey,"onUpdate:modelValue":t[1]||(t[1]=o=>g.value.rolePermKey=o),maxlength:"10",placeholder:e.value.rolePermKey,clearable:"",style:{width:"180px"}},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),l(m,{label:e.value.status},{default:a(()=>[l(S,{modelValue:g.value.status,"onUpdate:modelValue":t[2]||(t[2]=o=>g.value.status=o),size:"default",placeholder:e.value.status,clearable:"",style:{width:"180px"}},{default:a(()=>[l(V,{label:e.value.normal,value:"0"},null,8,["label"]),l(V,{label:e.value.deleted,value:"-1"},null,8,["label"])]),_:1},8,["modelValue","placeholder"])]),_:1},8,["label"]),l(m,null,{default:a(()=>[l(v,{type:"primary",plain:"",onClick:pe},{default:a(()=>[d(s(e.value.search),1)]),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),p("div",Ee,[l(v,{type:"primary",onClick:fe},{default:a(()=>[d(s(e.value.addRole),1)]),_:1})]),M((y(),q(se,{shadow:"never",class:"usr_card_override content"},{default:a(()=>[l(Ie,{class:"role_table",data:le.value,"row-key":"roleId"},{empty:a(()=>[l(Ne,{description:e.value.noData},null,8,["description"])]),default:a(()=>[l(k,{label:e.value.roleId,width:"100",align:"center"},{default:a(o=>[d(s(o.row.roleId),1)]),_:1},8,["label"]),l(k,{label:e.value.roleName,width:"200"},{default:a(o=>[d(s(o.row.roleName),1)]),_:1},8,["label"]),l(k,{label:e.value.rolePermKey,width:"200"},{default:a(o=>[d(s(o.row.rolePermKey),1)]),_:1},8,["label"]),l(k,{label:e.value.roleDescription,width:"300"},{default:a(o=>[p("div",He,[l(ze,{placement:"top"},{content:a(()=>[p("div",{innerHTML:Fe(ee).addLineBreaks(o.row.roleDesc,25)},null,8,je)]),default:a(()=>[d(" "+s(o.row.roleDesc),1)]),_:2},1024)])]),_:1},8,["label"]),l(k,{label:e.value.status,align:"center"},{default:a(o=>[o.row.status===0?(y(),q(de,{key:0},{default:a(()=>[d(s(e.value.normal),1)]),_:1})):o.row.status===-1?(y(),q(de,{key:1,type:"warning"},{default:a(()=>[d(s(e.value.deleted),1)]),_:1})):A("",!0)]),_:1},8,["label"]),l(k,{fixed:"right",label:e.value.operations,width:"380"},{default:a(o=>[p("div",Oe,[o.row.status===0?(y(),C(ve,{key:0},[l(v,{type:"primary",plain:"",onClick:F=>he(o.row)},{default:a(()=>[d(s(e.value.assignPermissions),1)]),_:2},1032,["onClick"]),l(v,{type:"success",plain:"",onClick:F=>ge(o.row)},{default:a(()=>[d(s(e.value.edit),1)]),_:2},1032,["onClick"]),o.row.roleId>3?(y(),q(v,{key:0,type:"danger",plain:"",onClick:F=>Re(o.row)},{default:a(()=>[d(s(e.value.delete),1)]),_:2},1032,["onClick"])):A("",!0)],64)):A("",!0),o.row.status===-1?(y(),C(ve,{key:1},[l(v,{type:"warning",plain:"",onClick:F=>ke(o.row)},{default:a(()=>[d(s(e.value.restore),1)]),_:2},1032,["onClick"]),l(v,{type:"info",plain:"",onClick:F=>De(o.row)},{default:a(()=>[d(s(e.value.delete),1)]),_:2},1032,["onClick"])],64)):A("",!0)])]),_:1},8,["label"])]),_:1},8,["data"]),l(Ke,{background:"",layout:"prev, pager, next","current-page":g.value.pageNum,onCurrentChange:ce,"page-size":g.value.pageSize,total:ae.value},null,8,["current-page","page-size","total"])]),_:1})),[[U,E.value]]),l(P,{class:"add_role_dialog","close-on-click-modal":!1,modelValue:D.value,"onUpdate:modelValue":t[7]||(t[7]=o=>D.value=o),title:e.value.addRoleTitle,width:"600"},{footer:a(()=>[p("div",Je,[l(v,{onClick:t[6]||(t[6]=o=>D.value=!1)},{default:a(()=>[d(s(e.value.cancel),1)]),_:1}),l(v,{type:"primary",onClick:_e,loading:j.value},{default:a(()=>[d(s(e.value.confirm),1)]),_:1},8,["loading"])])]),default:a(()=>[M((y(),C("div",Ge,[l(Z,{model:b.value,ref_key:"addFormRef",ref:T,rules:oe.value,"label-width":"100px"},{default:a(()=>[l(m,{label:e.value.roleNameLabel,prop:"roleName"},{default:a(()=>[l(f,{modelValue:b.value.roleName,"onUpdate:modelValue":t[3]||(t[3]=o=>b.value.roleName=o),maxlength:"10",placeholder:e.value.roleName,style:{width:"250px"},clearable:""},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),l(m,{label:e.value.permKeyLabel,prop:"rolePermKey"},{default:a(()=>[l(f,{modelValue:b.value.rolePermKey,"onUpdate:modelValue":t[4]||(t[4]=o=>b.value.rolePermKey=o),maxlength:"30",placeholder:e.value.rolePermKey,style:{width:"250px"},clearable:""},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),l(m,{label:e.value.roleDescLabel,prop:"roleDesc"},{default:a(()=>[l(f,{modelValue:b.value.roleDesc,"onUpdate:modelValue":t[5]||(t[5]=o=>b.value.roleDesc=o),type:"textarea",maxlength:"50",rows:"4",placeholder:e.value.roleDescription,style:{width:"320px"}},null,8,["modelValue","placeholder"])]),_:1},8,["label"])]),_:1},8,["model","rules"])])),[[U,H.value]])]),_:1},8,["modelValue","title"]),l(P,{class:"edit_role_dialog","close-on-click-modal":!1,modelValue:w.value,"onUpdate:modelValue":t[12]||(t[12]=o=>w.value=o),title:e.value.editRoleTitle,width:"600"},{footer:a(()=>[p("div",We,[l(v,{onClick:t[11]||(t[11]=o=>w.value=!1)},{default:a(()=>[d(s(e.value.cancel),1)]),_:1}),l(v,{type:"primary",onClick:ye,loading:G.value},{default:a(()=>[d(s(e.value.confirm),1)]),_:1},8,["loading"])])]),default:a(()=>[M((y(),C("div",Qe,[l(Z,{model:i.value,ref_key:"editFormRef",ref:x,rules:oe.value,"label-width":"100px"},{default:a(()=>[l(m,{label:e.value.roleNameLabel,prop:"roleName"},{default:a(()=>[l(f,{modelValue:i.value.roleName,"onUpdate:modelValue":t[8]||(t[8]=o=>i.value.roleName=o),maxlength:"10",placeholder:e.value.roleName,style:{width:"250px"},clearable:""},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),l(m,{label:e.value.permKeyLabel,prop:"rolePermKey"},{default:a(()=>[l(f,{modelValue:i.value.rolePermKey,"onUpdate:modelValue":t[9]||(t[9]=o=>i.value.rolePermKey=o),maxlength:"30",placeholder:e.value.rolePermKey,style:{width:"250px"},clearable:""},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),l(m,{label:e.value.roleDescLabel,prop:"roleDesc"},{default:a(()=>[l(f,{modelValue:i.value.roleDesc,"onUpdate:modelValue":t[10]||(t[10]=o=>i.value.roleDesc=o),type:"textarea",maxlength:"50",rows:"4",placeholder:e.value.roleDescription,style:{width:"320px"}},null,8,["modelValue","placeholder"])]),_:1},8,["label"])]),_:1},8,["model","rules"])])),[[U,O.value]])]),_:1},8,["modelValue","title"]),l(P,{modelValue:I.value,"onUpdate:modelValue":t[14]||(t[14]=o=>I.value=o),title:e.value.deleteConfirmTitle,width:"500"},{footer:a(()=>[p("div",Xe,[l(v,{onClick:t[13]||(t[13]=o=>I.value=!1)},{default:a(()=>[d(s(e.value.cancel),1)]),_:1}),l(v,{type:"primary",onClick:Ve,loading:W.value},{default:a(()=>[d(s(e.value.confirm),1)]),_:1},8,["loading"])])]),default:a(()=>[p("span",null,s(re.value),1)]),_:1},8,["modelValue","title"]),l(P,{modelValue:K.value,"onUpdate:modelValue":t[16]||(t[16]=o=>K.value=o),title:e.value.restoreConfirmTitle,width:"500"},{footer:a(()=>[p("div",Ye,[l(v,{onClick:t[15]||(t[15]=o=>K.value=!1)},{default:a(()=>[d(s(e.value.cancel),1)]),_:1}),l(v,{type:"primary",onClick:Ce,loading:X.value},{default:a(()=>[d(s(e.value.confirm),1)]),_:1},8,["loading"])])]),default:a(()=>[p("span",null,s(ue.value),1)]),_:1},8,["modelValue","title"]),l(P,{modelValue:L.value,"onUpdate:modelValue":t[18]||(t[18]=o=>L.value=o),title:e.value.permanentDeleteTitle,width:"500"},{footer:a(()=>[p("div",Ze,[l(v,{onClick:t[17]||(t[17]=o=>L.value=!1)},{default:a(()=>[d(s(e.value.cancel),1)]),_:1}),l(v,{type:"primary",onClick:we,loading:Y.value},{default:a(()=>[d(s(e.value.confirm),1)]),_:1},8,["loading"])])]),default:a(()=>[p("span",null,s(ne.value),1)]),_:1},8,["modelValue","title"]),l(Te,{class:"usr_drawer_role_perm",modelValue:z.value,"onUpdate:modelValue":t[20]||(t[20]=o=>z.value=o),direction:"rtl",size:"350"},{header:a(()=>[p("h4",null,s(te.value),1)]),default:a(()=>[M((y(),C("div",el,[l(Pe,null,{default:a(()=>[l(Le,{ref_key:"permRoleTree",ref:$,data:J.value,props:{label:"menuName",children:"children"},"show-checkbox":"","check-strictly":!0,"default-expand-all":"","node-key":"menuId"},null,8,["data"])]),_:1})])),[[U,N.value]])]),footer:a(()=>[p("div",ll,[l(v,{onClick:t[19]||(t[19]=o=>z.value=!1)},{default:a(()=>[d(s(e.value.cancel),1)]),_:1}),l(v,{type:"primary",onClick:be,loading:Q.value},{default:a(()=>[d(s(e.value.confirm),1)]),_:1},8,["loading"])])]),_:1},8,["modelValue"])])}}},rl=xe(al,[["__scopeId","data-v-620055e7"]]);export{rl as default};
